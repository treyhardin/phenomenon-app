---
import { getCollection } from 'astro:content'
import LocationList from '../components/LocationList.astro'
import LayoutApp from '../layouts/layoutApp.astro'
import { supabase } from '../lib/supabase'

const countries = await getCollection('countries')

const states = countries.map((country) => ({
	title: country.data.canonical_name,
	url: `/${country.data.id}`,
	count: country.data.record_count.toLocaleString()
}))

const { data: reports, error } = await supabase
  .from('Clean Data')
  .select()
  .not('dateOccurred', 'is', null)
  .order('dateOccurred', {ascending: false})
  .limit(20)
---
<LayoutApp
	title='UAP Database'
	reports={reports}
>
	<LocationList
		categoryTitle="Country"
		locations={states}
	/>
</LayoutApp>